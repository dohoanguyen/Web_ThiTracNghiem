@*@using System.Linq
    @model List<Web_KLCN.Models.DiemThiVM>
    @{
        ViewBag.Title = "Điểm thi";
        Layout = "~/Views/Shared/LayoutPage.cshtml";
    }

    <div class="container py-4 fade-in">
        <h3 class="fw-bold mb-4" style="color:#1800AC;">Lịch sử điểm thi</h3>

        @if (!Model.Any())
        {
            <div class="alert alert-warning text-center">
                Bạn chưa có bài thi nào!
            </div>
        }
        else
        {
            <table class="table table-bordered shadow-sm rounded-4 overflow-hidden">
                <thead class="text-white" style="background:#1800AC;">
                    <tr>
                        <th>Môn</th>
                        <th>Đề thi</th>
                        <th>Điểm</th>
                        <th>Số câu đúng</th>
                        <th>Ngày thi</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.MonHoc</td>
                            <td>@item.TenDe</td>
                            <td class="fw-bold">@item.Diem</td>
                            <td>@item.SoCauDung</td>
                            <td>@(item.NgayThi.HasValue ? item.NgayThi.Value.ToString("dd/MM/yyyy") : "")</td>
                            <td>
                                <a href="@Url.Action("XemLaiBaiLam", "HocVien", new { id = item.MaKQ })"
                                   class="btn btn-sm btn-outline-primary rounded-3">
                                    <i class="fa-solid fa-eye me-2"></i>Xem lại
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>*@


@using System.Linq
@model List<Web_KLCN.Models.DiemThiVM>
@{
    ViewBag.Title = "Lịch sử điểm thi";
    Layout = "~/Views/Shared/LayoutPage.cshtml";
}

<div class="container mx-auto py-8 px-4 animate-fadeIn">
    <h3 class="text-3xl font-bold mb-6 text-primary">
        <span class="material-symbols-outlined align-middle me-2 text-2xl">analytics</span> Lịch sử điểm thi
    </h3>

    @if (!Model.Any())
    {
        <div class="p-6 bg-yellow-100 text-yellow-800 border border-yellow-300 rounded-xl shadow-lg text-center">
            <h5 class="text-xl font-bold mb-2">Chưa có dữ liệu bài thi!</h5>
            <p class="mb-0 text-yellow-700">Hãy bắt đầu làm một bài kiểm tra để xem lại kết quả tại đây.</p>
        </div>
    }
    else
    {
        // --- 1. HIỂN THỊ DẠNG BẢNG (CHO MÀN HÌNH LỚN) ---
        <div class="hidden md:block">
            <div class="overflow-x-auto rounded-xl shadow-xl border border-gray-100 dark:border-gray-700">
                <table class="table w-full bg-white dark:bg-surface-dark">
                    <thead>
                        <tr class="text-white" style="background:#1800AC;">
                            <th class="py-3 px-4 rounded-tl-xl text-left">Đề thi</th>
                            <th class="py-3 px-4 text-center">Môn</th>
                            <th class="py-3 px-4 text-center">Ngày thi</th>
                            <th class="py-3 px-4 text-center">Số câu đúng</th>
                            <th class="py-3 px-4 text-center rounded-tr-xl">Điểm</th>
                            <th class="py-3 px-4 text-center"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderByDescending(x => x.NgayThi))
                        {
                            // Logic màu cho cột điểm
                            string scoreClass = item.Diem >= 8 ? "text-green-600" : (item.Diem >= 5 ? "text-primary" : "text-red-600");

                            <tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                                <td class="py-3 px-4 font-semibold text-text-light dark:text-text-dark max-w-xs truncate">@item.TenDe</td>
                                <td class="py-3 px-4 text-center text-text-muted-light dark:text-text-muted-dark">@item.MonHoc</td>
                                <td class="py-3 px-4 text-center text-text-muted-light dark:text-text-muted-dark">@(item.NgayThi.HasValue ? item.NgayThi.Value.ToString("dd/MM/yyyy") : "N/A")</td>
                                <td class="py-3 px-4 text-center text-text-muted-light dark:text-text-muted-dark">@item.SoCauDung</td>
                                <td class="py-3 px-4 text-center font-bold @scoreClass text-xl">@item.Diem.ToString("F2")</td>
                                <td class="py-3 px-4 text-center">
                                    <a href="@Url.Action("XemLaiBaiLam", "HocVien", new { id = item.MaKQ })"
                                       class="btn btn-sm btn-outline btn-primary rounded-full normal-case px-4">
                                        <span class="material-symbols-outlined text-base">visibility</span> Xem lại
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        // --- 2. HIỂN THỊ DẠNG CARD (CHO MÀN HÌNH NHỎ) ---
        <div class="md:hidden space-y-4">
            @foreach (var item in Model.OrderByDescending(x => x.NgayThi))
            {
                string scoreClass = item.Diem >= 8 ? "text-green-600" : (item.Diem >= 5 ? "text-primary" : "text-red-600");

                <div class="card w-full bg-white dark:bg-surface-dark shadow-lg border border-gray-100 dark:border-gray-700 transition-shadow hover:shadow-xl">
                    <div class="card-body p-4">
                        <div class="flex justify-between items-start">
                            <h4 class="card-title text-primary text-lg font-bold mb-1">@item.TenDe</h4>
                            <span class="font-bolder @scoreClass text-2xl">@item.Diem.ToString("F2")</span>
                        </div>

                        <p class="text-sm text-text-muted-light dark:text-text-muted-dark mb-3">
                            <span class="material-symbols-outlined text-sm align-bottom me-1">school</span> Môn: <span class="font-medium text-text-light dark:text-text-dark">@item.MonHoc</span>
                        </p>

                        <div class="flex justify-between text-xs text-text-muted-light dark:text-text-muted-dark mb-4">
                            <span>
                                <span class="material-symbols-outlined text-sm align-bottom me-1">check_circle</span> Đúng: @item.SoCauDung câu
                            </span>
                            <span>
                                <span class="material-symbols-outlined text-sm align-bottom me-1">calendar_month</span> Ngày thi: @(item.NgayThi.HasValue ? item.NgayThi.Value.ToString("dd/MM/yyyy") : "N/A")
                            </span>
                        </div>

                        <div class="card-actions justify-end">
                            <a href="@Url.Action("XemLaiBaiLam", "HocVien", new { id = item.MaKQ })"
                               class="btn btn-sm btn-primary rounded-full normal-case">
                                <span class="material-symbols-outlined text-base">visibility</span> Chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>